# .github/workflows/build.yml
name: ImmortalWrt å›ºä»¶ç¼–è¯‘ç³»ç»Ÿ

on:
  push:
    branches: [ main, master ]
    tags:
      - 'v*'
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:
    inputs:
      variant:
        description: 'é€‰æ‹©è¦ç¼–è¯‘çš„å˜ä½“'
        required: true
        default: 'all'
        type: choice
        options:
        - all
        - ultra
        - max
        - pro

env:
  # ç‰ˆæœ¬æŽ§åˆ¶
  VERSION: "1.0.0"
  RELEASE_DATE: "2025-11-18"
  
  # ä»“åº“é…ç½®
  REPO_OWNER: laipeng668
  REPO_NAME: immortalwrt
  REPO_BRANCH: master
  
  # å›ºä»¶é…ç½®
  FIRMWARE_IP: "192.168.111.1"
  FIRMWARE_NAME: "WRT"
  AUTHOR_NAME: "Mary"
  
  # ç³»ç»Ÿé…ç½®
  TZ: "Asia/Shanghai"

jobs:
  prepare:
    runs-on: ubuntu-24.04
    outputs:
      device_list: ${{ steps.extract_devices.outputs.devices }}
      cache_key: ${{ steps.cache_key.outputs.key }}
      cache_version: ${{ steps.cache_key.outputs.version }}
    steps:
    - name: ðŸš€ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ðŸ“… è®¾ç½®çŽ¯å¢ƒå˜é‡
      run: |
        echo "BUILD_DATE=$(date +%Y-%m-%d)" >> $GITHUB_ENV
        echo "BUILD_TIME=$(date +%H:%M:%S)" >> $GITHUB_ENV
        echo "BUILD_TIMESTAMP=$(date +%s)" >> $GITHUB_ENV
        echo "TOOLCHAIN_VERSION=$(date +%Y%m%d)" >> $GITHUB_ENV

    - name: ðŸ“¦ å®‰è£…å¿…è¦çš„è½¯ä»¶åŒ…
      run: |
        sudo apt-get update
        sudo apt-get install -y build-essential ccache ecj fastjar file g++ gawk gettext git java-propose-classpath libelf-dev libncurses5-dev libncursesw5-dev libssl-dev python3 unzip python3-ziputils python3-pyelftools python3-pip rsync subversion swig time wget vim python3-pyelftools python3-dev curl jq

    - name: ðŸ”‘ åˆ›å»ºç¼“å­˜é”®
      id: cache_key
      run: |
        # ä½¿ç”¨æºç åˆ†æ”¯ã€å·¥å…·é“¾ç‰ˆæœ¬å’Œæ—¥æœŸä½œä¸ºç¼“å­˜é”®
        echo "key=immwrt-${{ env.REPO_BRANCH }}-${{ env.TOOLCHAIN_VERSION }}" >> $GITHUB_OUTPUT
        echo "version=${{ env.VERSION }}-${{ env.RELEASE_DATE }}" >> $GITHUB_OUTPUT
        echo -e "\033[1;32mâœ… ç¼“å­˜é”®: immwrt-${{ env.REPO_BRANCH }}-${{ env.TOOLCHAIN_VERSION }}\033[0m"

    - name: ðŸ“± æå–è®¾å¤‡åç§°
      id: extract_devices
      run: |
        # æå–è®¾å¤‡åç§°
        if [ -f "configs/base_ipq60xx.config" ]; then
          devices=$(grep -oE 'CONFIG_TARGET_DEVICE_[^_]+_DEVICE_[^=]+' configs/base_ipq60xx.config | sed 's/CONFIG_TARGET_DEVICE_[^_]*_DEVICE_//')
        else
          # å¦‚æžœé…ç½®æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä½¿ç”¨é»˜è®¤è®¾å¤‡
          devices="jdcloud_re-ss-01 jdcloud_re-cs-02"
        fi
        echo "devices=$devices" >> $GITHUB_OUTPUT
        echo -e "\033[1;32mâœ… æ‰¾åˆ°çš„è®¾å¤‡: $devices\033[0m"

    - name: ðŸ“ åˆ›å»ºå·¥ä½œç›®å½•
      run: |
        mkdir -p build workspace

    - name: ðŸ’¾ æ‰©å±•ç£ç›˜ç©ºé—´
      run: |
        # åˆ›å»ºè½¯é“¾æŽ¥æ‰©å±•ç£ç›˜ç©ºé—´
        sudo mkdir -p /mnt/ramdisk
        sudo mount -t tmpfs -o size=10G tmpfs /mnt/ramdisk
        sudo mkdir -p /mnt/ramdisk/build
        sudo chown $USER:$USER /mnt/ramdisk/build
        ln -sf /mnt/ramdisk/build ./build
        echo -e "\033[1;32mâœ… ç£ç›˜ç©ºé—´æ‰©å±•æˆåŠŸ\033[0m"

  build-ultra:
    needs: prepare
    runs-on: ubuntu-24.04
    if: github.event.inputs.variant == 'all' || github.event.inputs.variant == 'ultra' || github.event.inputs.variant == ''
    outputs:
      cache_hit: ${{ steps.cache.outputs.cache-hit }}
    steps:
    - name: ðŸš€ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ðŸ’¾ æ¢å¤å·¥ä½œç›®å½•
      run: |
        sudo mkdir -p /mnt/ramdisk
        sudo mount -t tmpfs -o size=10G tmpfs /mnt/ramdisk
        sudo mkdir -p /mnt/ramdisk/build
        sudo chown $USER:$USER /mnt/ramdisk/build
        ln -sf /mnt/ramdisk/build ./build

    - name: ðŸ’¾ æ¢å¤ç¼“å­˜
      uses: actions/cache@v4
      id: cache
      with:
        path: |
          ./build
          ~/.ccache
        key: ${{ needs.prepare.outputs.cache_key }}-ultra
        restore-keys: |
          immwrt-${{ env.REPO_BRANCH }}-

    - name: ðŸ“¥ å…‹éš†æºç ä»“åº“
      run: |
        echo -e "\033[1;34mðŸ“¥ å¼€å§‹å…‹éš†æºç ä»“åº“...\033[0m"
        git clone https://github.com/${{ env.REPO_OWNER }}/${{ env.REPO_NAME }}.git -b ${{ env.REPO_BRANCH }} build/source
        cd build/source
        
        # å¤åˆ¶é…ç½®æ–‡ä»¶å’Œè„šæœ¬
        if [ -d "../../configs" ]; then
          cp ../../configs/* ../configs/
        fi
        if [ -d "../../scripts" ]; then
          cp ../../scripts/* ../scripts/
          chmod +x ../scripts/*.sh
        fi

    - name: ðŸ”§ åˆå¹¶é…ç½®æ–‡ä»¶
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ”§ åˆå¹¶é…ç½®æ–‡ä»¶...\033[0m"
        
        # åˆ›å»ºé…ç½®ç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        mkdir -p ../configs
        
        # ä¸‹è½½é…ç½®æ–‡ä»¶ï¼ˆå¦‚æžœæœ¬åœ°ä¸å­˜åœ¨ï¼‰
        if [ ! -f "../configs/base_ipq60xx.config" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/configs/base_ipq60xx.config -o ../configs/base_ipq60xx.config
        fi
        if [ ! -f "../configs/base_immwrt.config" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/configs/base_immwrt.config -o ../configs/base_immwrt.config
        fi
        if [ ! -f "../configs/Ultra.config" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/configs/Ultra.config -o ../configs/Ultra.config
        fi
        
        # åˆå¹¶é…ç½®æ–‡ä»¶
        cat ../configs/base_ipq60xx.config ../configs/base_immwrt.config ../configs/Ultra.config > .config
        
        # è¿è¡Œ defconfig è¡¥å…¨é…ç½®
        make defconfig
        
        # æå–å¹¶æ˜¾ç¤º luci è½¯ä»¶åŒ…å·®å¼‚
        echo -e "\033[1;33mðŸ“‹ LUCI è½¯ä»¶åŒ…æŠ¥å‘Š\033[0m"
        grep -E '^CONFIG_PACKAGE_luci.*=y$' .config > ../luci-after.txt
        
        echo -e "\033[1;36mðŸ“¦ å·²åŒ…å«çš„ LUCI è½¯ä»¶åŒ…:\033[0m"
        cat ../luci-after.txt | while read line; do
          pkg=$(echo $line | sed 's/CONFIG_PACKAGE_//g' | sed 's/=y//g')
          echo -e "  âœ¨ $pkg"
        done

    - name: ðŸŽ¨ åº”ç”¨è‡ªå®šä¹‰è„šæœ¬
      run: |
        cd build/source
        echo -e "\033[1;34mðŸŽ¨ åº”ç”¨è‡ªå®šä¹‰è„šæœ¬...\033[0m"
        
        # åˆ›å»ºè„šæœ¬ç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        mkdir -p ../scripts
        
        # ä¸‹è½½è„šæœ¬ï¼ˆå¦‚æžœæœ¬åœ°ä¸å­˜åœ¨ï¼‰
        if [ ! -f "../scripts/diy.sh" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/scripts/diy.sh -o ../scripts/diy.sh
        fi
        
        # è®¾ç½®çŽ¯å¢ƒå˜é‡
        export FIRMWARE_IP="${{ env.FIRMWARE_IP }}"
        export FIRMWARE_NAME="${{ env.FIRMWARE_NAME }}"
        export AUTHOR_NAME="${{ env.AUTHOR_NAME }}"
        
        # æ‰§è¡Œè„šæœ¬
        chmod +x ../scripts/diy.sh
        ../scripts/diy.sh

    - name: ðŸ“¦ æ·»åŠ ç¬¬ä¸‰æ–¹è½¯ä»¶æº
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ“¦ æ·»åŠ ç¬¬ä¸‰æ–¹è½¯ä»¶æº...\033[0m"
        
        # ä¸‹è½½è„šæœ¬ï¼ˆå¦‚æžœæœ¬åœ°ä¸å­˜åœ¨ï¼‰
        if [ ! -f "../scripts/repo.sh" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/scripts/repo.sh -o ../scripts/repo.sh
        fi
        
        # æ‰§è¡Œè„šæœ¬
        chmod +x ../scripts/repo.sh
        ../scripts/repo.sh

    - name: ðŸ”„ æ›´æ–° feeds
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ”„ æ›´æ–° feeds...\033[0m"
        ./scripts/feeds update -a
        echo -e "\033[1;34mðŸ“¦ å®‰è£… feeds...\033[0m"
        ./scripts/feeds install -a

    - name: ðŸ”¨ ç¼–è¯‘å›ºä»¶
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ”¨ å¼€å§‹ç¼–è¯‘å›ºä»¶...\033[0m"
        make -j$(nproc) || make -j1 || echo -e "\033[1;31mâŒ ç¼–è¯‘å¤±è´¥\033[0m"

    - name: ðŸ“¦ æ•´ç†ç¼–è¯‘äº§ç‰©
      run: |
        cd build/source
        mkdir -p ../output/ultra
        find bin/targets -name "*.bin" -o -name "*.img" -o -name "*.sysupgrade" | xargs -I {} cp {} ../output/ultra/
        
        # é‡å‘½åå›ºä»¶æ–‡ä»¶
        for device in ${{ needs.prepare.outputs.device_list }}; do
          if [ -f "../output/ultra/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" ]; then
            mv "../output/ultra/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" "../output/ultra/ImmortalWrt-${device}-Ultra-${{ env.BUILD_DATE }}.bin"
            echo -e "\033[1;32mâœ… é‡å‘½å: ImmortalWrt-${device}-Ultra-${{ env.BUILD_DATE }}.bin\033[0m"
          fi
        done

    - name: ðŸ“¤ ä¸Šä¼ ç¼–è¯‘äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: immortalwrt-ultra
        path: build/output/ultra/
        retention-days: 7

  build-max:
    needs: [prepare, build-ultra]
    runs-on: ubuntu-24.04
    if: github.event.inputs.variant == 'all' || github.event.inputs.variant == 'max' || github.event.inputs.variant == ''
    steps:
    - name: ðŸš€ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ðŸ’¾ æ¢å¤å·¥ä½œç›®å½•
      run: |
        sudo mkdir -p /mnt/ramdisk
        sudo mount -t tmpfs -o size=10G tmpfs /mnt/ramdisk
        sudo mkdir -p /mnt/ramdisk/build
        sudo chown $USER:$USER /mnt/ramdisk/build
        ln -sf /mnt/ramdisk/build ./build

    - name: ðŸ’¾ æ¢å¤ç¼“å­˜
      uses: actions/cache@v4
      with:
        path: |
          ./build
          ~/.ccache
        key: ${{ needs.prepare.outputs.cache_key }}-ultra
        restore-keys: |
          immwrt-${{ env.REPO_BRANCH }}-

    - name: ðŸ”§ åˆå¹¶é…ç½®æ–‡ä»¶
      run: |
        cd build/source
        
        # åˆ›å»ºé…ç½®ç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        mkdir -p ../configs
        
        # ä¸‹è½½é…ç½®æ–‡ä»¶ï¼ˆå¦‚æžœæœ¬åœ°ä¸å­˜åœ¨ï¼‰
        if [ ! -f "../configs/Max.config" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/configs/Max.config -o ../configs/Max.config
        fi
        
        # å¤‡ä»½å½“å‰é…ç½®
        cp .config ../configs/Ultra-backup.config
        
        # åˆå¹¶é…ç½®
        cat ../configs/base_ipq60xx.config ../configs/base_immwrt.config ../configs/Max.config > .config
        
        # è¿è¡Œ defconfig è¡¥å…¨é…ç½®
        make defconfig
        
        # æå–å¹¶æ˜¾ç¤º luci è½¯ä»¶åŒ…å·®å¼‚
        echo -e "\033[1;33mðŸ“‹ LUCI è½¯ä»¶åŒ…å·®å¼‚æŠ¥å‘Š (Max vs Ultra)\033[0m"
        grep -E '^CONFIG_PACKAGE_luci.*=y$' .config > ../luci-after.txt
        grep -E '^CONFIG_PACKAGE_luci.*=y$' ../configs/Ultra-backup.config > ../luci-before.txt
        
        echo -e "\033[1;32mâž• æ–°å¢žçš„ LUCI è½¯ä»¶åŒ…:\033[0m"
        comm -13 ../luci-before.txt ../luci-after.txt | while read line; do
          pkg=$(echo $line | sed 's/CONFIG_PACKAGE_//g' | sed 's/=y//g')
          echo -e "  âœ¨ $pkg"
        done || echo -e "  ðŸ“­ æ— æ–°å¢ž"
        
        echo -e "\033[1;31mâž– ç§»é™¤çš„ LUCI è½¯ä»¶åŒ…:\033[0m"
        comm -23 ../luci-before.txt ../luci-after.txt | while read line; do
          pkg=$(echo $line | sed 's/CONFIG_PACKAGE_//g' | sed 's/=y//g')
          echo -e "  ðŸ—‘ï¸ $pkg"
        done || echo -e "  ðŸ“­ æ— ç§»é™¤"

    - name: ðŸ”¨ ç¼–è¯‘å›ºä»¶
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ”¨ å¼€å§‹ç¼–è¯‘ Max å›ºä»¶...\033[0m"
        make -j$(nproc) || make -j1 || echo -e "\033[1;31mâŒ ç¼–è¯‘å¤±è´¥\033[0m"

    - name: ðŸ“¦ æ•´ç†ç¼–è¯‘äº§ç‰©
      run: |
        cd build/source
        mkdir -p ../output/max
        find bin/targets -name "*.bin" -o -name "*.img" -o -name "*.sysupgrade" | xargs -I {} cp {} ../output/max/
        
        # é‡å‘½åå›ºä»¶æ–‡ä»¶
        for device in ${{ needs.prepare.outputs.device_list }}; do
          if [ -f "../output/max/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" ]; then
            mv "../output/max/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" "../output/max/ImmortalWrt-${device}-Max-${{ env.BUILD_DATE }}.bin"
            echo -e "\033[1;32mâœ… é‡å‘½å: ImmortalWrt-${device}-Max-${{ env.BUILD_DATE }}.bin\033[0m"
          fi
        done

    - name: ðŸ“¤ ä¸Šä¼ ç¼–è¯‘äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: immortalwrt-max
        path: build/output/max/
        retention-days: 7

  build-pro:
    needs: [prepare, build-ultra]
    runs-on: ubuntu-24.04
    if: github.event.inputs.variant == 'all' || github.event.inputs.variant == 'pro' || github.event.inputs.variant == ''
    steps:
    - name: ðŸš€ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4

    - name: ðŸ’¾ æ¢å¤å·¥ä½œç›®å½•
      run: |
        sudo mkdir -p /mnt/ramdisk
        sudo mount -t tmpfs -o size=10G tmpfs /mnt/ramdisk
        sudo mkdir -p /mnt/ramdisk/build
        sudo chown $USER:$USER /mnt/ramdisk/build
        ln -sf /mnt/ramdisk/build ./build

    - name: ðŸ’¾ æ¢å¤ç¼“å­˜
      uses: actions/cache@v4
      with:
        path: |
          ./build
          ~/.ccache
        key: ${{ needs.prepare.outputs.cache_key }}-ultra
        restore-keys: |
          immwrt-${{ env.REPO_BRANCH }}-

    - name: ðŸ”§ åˆå¹¶é…ç½®æ–‡ä»¶
      run: |
        cd build/source
        
        # åˆ›å»ºé…ç½®ç›®å½•ï¼ˆå¦‚æžœä¸å­˜åœ¨ï¼‰
        mkdir -p ../configs
        
        # ä¸‹è½½é…ç½®æ–‡ä»¶ï¼ˆå¦‚æžœæœ¬åœ°ä¸å­˜åœ¨ï¼‰
        if [ ! -f "../configs/Pro.config" ]; then
          curl -L https://raw.githubusercontent.com/aghu1979/ipq60x2/main/configs/Pro.config -o ../configs/Pro.config
        fi
        
        # å¤‡ä»½å½“å‰é…ç½®
        cp .config ../configs/Ultra-backup.config
        
        # åˆå¹¶é…ç½®
        cat ../configs/base_ipq60xx.config ../configs/base_immwrt.config ../configs/Pro.config > .config
        
        # è¿è¡Œ defconfig è¡¥å…¨é…ç½®
        make defconfig
        
        # æå–å¹¶æ˜¾ç¤º luci è½¯ä»¶åŒ…å·®å¼‚
        echo -e "\033[1;33mðŸ“‹ LUCI è½¯ä»¶åŒ…å·®å¼‚æŠ¥å‘Š (Pro vs Ultra)\033[0m"
        grep -E '^CONFIG_PACKAGE_luci.*=y$' .config > ../luci-after.txt
        grep -E '^CONFIG_PACKAGE_luci.*=y$' ../configs/Ultra-backup.config > ../luci-before.txt
        
        echo -e "\033[1;32mâž• æ–°å¢žçš„ LUCI è½¯ä»¶åŒ…:\033[0m"
        comm -13 ../luci-before.txt ../luci-after.txt | while read line; do
          pkg=$(echo $line | sed 's/CONFIG_PACKAGE_//g' | sed 's/=y//g')
          echo -e "  âœ¨ $pkg"
        done || echo -e "  ðŸ“­ æ— æ–°å¢ž"
        
        echo -e "\033[1;31mâž– ç§»é™¤çš„ LUCI è½¯ä»¶åŒ…:\033[0m"
        comm -23 ../luci-before.txt ../luci-after.txt | while read line; do
          pkg=$(echo $line | sed 's/CONFIG_PACKAGE_//g' | sed 's/=y//g')
          echo -e "  ðŸ—‘ï¸ $pkg"
        done || echo -e "  ðŸ“­ æ— ç§»é™¤"

    - name: ðŸ”¨ ç¼–è¯‘å›ºä»¶
      run: |
        cd build/source
        echo -e "\033[1;34mðŸ”¨ å¼€å§‹ç¼–è¯‘ Pro å›ºä»¶...\033[0m"
        make -j$(nproc) || make -j1 || echo -e "\033[1;31mâŒ ç¼–è¯‘å¤±è´¥\033[0m"

    - name: ðŸ“¦ æ•´ç†ç¼–è¯‘äº§ç‰©
      run: |
        cd build/source
        mkdir -p ../output/pro
        find bin/targets -name "*.bin" -o -name "*.img" -o -name "*.sysupgrade" | xargs -I {} cp {} ../output/pro/
        
        # é‡å‘½åå›ºä»¶æ–‡ä»¶
        for device in ${{ needs.prepare.outputs.device_list }}; do
          if [ -f "../output/pro/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" ]; then
            mv "../output/pro/immortalwrt-*-qualcommax-ipq60xx-${device}-squashfs-sysupgrade.bin" "../output/pro/ImmortalWrt-${device}-Pro-${{ env.BUILD_DATE }}.bin"
            echo -e "\033[1;32mâœ… é‡å‘½å: ImmortalWrt-${device}-Pro-${{ env.BUILD_DATE }}.bin\033[0m"
          fi
        done

    - name: ðŸ“¤ ä¸Šä¼ ç¼–è¯‘äº§ç‰©
      uses: actions/upload-artifact@v4
      with:
        name: immortalwrt-pro
        path: build/output/pro/
        retention-days: 7

  release:
    needs: [prepare, build-ultra, build-max, build-pro]
    runs-on: ubuntu-24.04
    if: success() && (github.event.inputs.variant == 'all' || github.event.inputs.variant == '')
    steps:
    - name: ðŸ“ åˆ›å»ºå‘å¸ƒç›®å½•
      run: |
        mkdir -p release

    - name: ðŸ“¥ ä¸‹è½½æ‰€æœ‰ç¼–è¯‘äº§ç‰©
      uses: actions/download-artifact@v4
      with:
        path: release

    - name: ðŸ“ åˆ›å»ºå‘å¸ƒè¯´æ˜Ž
      run: |
        cat > release/RELEASE_NOTES.md << EOF
        # ImmortalWrt å›ºä»¶å‘å¸ƒ ðŸš€
        
        ## ðŸ“… æž„å»ºä¿¡æ¯
        - ç‰ˆæœ¬: ${{ needs.prepare.outputs.cache_version }}
        - æž„å»ºæ—¥æœŸ: ${{ env.BUILD_DATE }}
        - æž„å»ºæ—¶é—´: ${{ env.BUILD_TIME }}
        - æºç ä»“åº“: ${{ env.REPO_OWNER }}/${{ env.REPO_NAME }}
        - æºç åˆ†æ”¯: ${{ env.REPO_BRANCH }}
        
        ## ðŸŽ¯ å›ºä»¶å˜ä½“
        - **Ultra**: åŒ…å«æ‰€æœ‰åŠŸèƒ½å’Œè½¯ä»¶åŒ… ðŸŒŸ
        - **Max**: åŒ…å«å¤§éƒ¨åˆ†åŠŸèƒ½å’Œè½¯ä»¶åŒ… â­
        - **Pro**: åŒ…å«å¸¸ç”¨åŠŸèƒ½å’Œè½¯ä»¶åŒ… âœ¨
        
        ## ðŸ“± æ”¯æŒçš„è®¾å¤‡
        ${{ needs.prepare.outputs.device_list }}
        
        ## ðŸ”§ å›ºä»¶ä¿¡æ¯
        - å›ºä»¶IPåœ°å€: ${{ env.FIRMWARE_IP }}
        - å›ºä»¶åç§°: ${{ env.FIRMWARE_NAME }}
        - ä½œè€…: ${{ env.AUTHOR_NAME }}
        - é»˜è®¤å¯†ç : ç©º
        
        ## ðŸŽ¨ ä¸»é¢˜
        - Argon ä¸»é¢˜
        - Aurora ä¸»é¢˜
        
        ## ðŸ“¦ ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…
        æœ¬å›ºä»¶åŒ…å«ä»¥ä¸‹ç¬¬ä¸‰æ–¹è½¯ä»¶åŒ…:
        - ðŸ® äº¬ä¸œäº‘é›…å…¸å¨œLEDæŽ§åˆ¶
        - ðŸš‡ Passwall / Passwall2
        - ðŸ›¡ï¸ AdGuardHome
        - ðŸŒ DDNS-GO
        - ðŸ“Š NetData
        - âš¡ ç½‘ç»œæµ‹é€Ÿ
        - ðŸ’¾ åˆ†åŒºç®¡ç†
        - â° ä»»åŠ¡è®¡åˆ’
        - ðŸ€ Lucky
        - ðŸ”— EasyTier
        - ðŸ  HomeProxy
        - ðŸ¹ Golang & OpenList2
        - ðŸŒŠ MosDNS
        - ðŸ“ QuickFile
        - ðŸŽ­ Momo / Nikki
        - ðŸ”’ OpenAppFilter
        - âš”ï¸ OpenClash
        - ðŸ¦Š Tailscale
        - ðŸŒ VNT
        
        ## âš ï¸ æ³¨æ„äº‹é¡¹
        1. é¦–æ¬¡åˆ·æœºåŽè¯·æ¢å¤å‡ºåŽ‚è®¾ç½®
        2. å¦‚é‡é—®é¢˜ï¼Œè¯·å°è¯•æ¢å¤å‡ºåŽ‚è®¾ç½®
        3. æ›´å¤šä¿¡æ¯è¯·è®¿é—®é¡¹ç›®ä¸»é¡µ
        
        ---
        æž„å»ºäºŽ ${{ env.BUILD_DATE }} ${{ env.BUILD_TIME }}
        EOF

    - name: ðŸš€ å‘å¸ƒå›ºä»¶
      uses: softprops/action-gh-release@v2
      with:
        name: ImmortalWrt ${{ env.BUILD_DATE }}
        body_path: release/RELEASE_NOTES.md
        draft: false
        prerelease: false
        files: |
          release/**/*
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
